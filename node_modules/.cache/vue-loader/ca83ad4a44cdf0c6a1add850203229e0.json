{"remainingRequest":"/Users/momo/code/vue/live-data-analysis-static/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/momo/code/vue/live-data-analysis-static/src/views/dashboard/Member.vue?vue&type=style&index=0&id=0bc52fa2&lang=less&scoped=true&","dependencies":[{"path":"/Users/momo/code/vue/live-data-analysis-static/src/views/dashboard/Member.vue","mtime":1626864386000},{"path":"/Users/momo/code/vue/live-data-analysis-static/node_modules/css-loader/dist/cjs.js","mtime":1647848753997},{"path":"/Users/momo/code/vue/live-data-analysis-static/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1647848754116},{"path":"/Users/momo/code/vue/live-data-analysis-static/node_modules/postcss-loader/src/index.js","mtime":1647586367416},{"path":"/Users/momo/code/vue/live-data-analysis-static/node_modules/less-loader/dist/cjs.js","mtime":1647586450216},{"path":"/Users/momo/code/vue/live-data-analysis-static/node_modules/cache-loader/dist/cjs.js","mtime":1647586199048},{"path":"/Users/momo/code/vue/live-data-analysis-static/node_modules/vue-loader/lib/index.js","mtime":1647848754116}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmV4dHJhLXdyYXBwZXIgewogIGxpbmUtaGVpZ2h0OiA1NXB4OwogIHBhZGRpbmctcmlnaHQ6IDI0cHg7CgogIC5leHRyYS1pdGVtIHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIG1hcmdpbi1yaWdodDogMjRweDsKCiAgICBhIHsKICAgICAgbWFyZ2luLWxlZnQ6IDI0cHg7CiAgICB9CiAgfQp9CgouYW50ZC1wcm8tcGFnZXMtZGFzaGJvYXJkLWFuYWx5c2lzLXR3b0NvbExheW91dCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IGZsZXg7CiAgZGlzcGxheTogYmxvY2s7CiAgZmxleC1mbG93OiByb3cgd3JhcDsKfQoKLmFudGQtcHJvLXBhZ2VzLWRhc2hib2FyZC1hbmFseXNpcy1zYWxlc0NhcmQgewogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogY2FsYygxMDAlIC0gMjRweCk7CiAgLyogL2RlZXAvIC5hbnQtY2FyZC1oZWFkIHsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB9ICovCn0KCi5hbnQtY29sLTMgewogIHdpZHRoOiAzMyU7Cn0KCi5hbnQtZm9udC0yIHsKICBmb250LXNpemU6IDEzcHg7Cn0KLmRhc2hib2FyZC1hbmFseXNpcy1pY29uR3JvdXAgewogIGkgewogICAgbWFyZ2luLWxlZnQ6IDE2cHg7CiAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjQ1KTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRyYW5zaXRpb246IGNvbG9yIDAuMzJzOwogICAgY29sb3I6IGJsYWNrOwogIH0KfQouYW5hbHlzaXMtc2FsZXNUeXBlUmFkaW8gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICByaWdodDogNTRweDsKICBib3R0b206IDEycHg7Cn0KCi50aW1lUmFkaW9Hcm91cCB7CiAgbWFyZ2luLWxlZnQ6IDU0cHg7Cn0KCi50aW1lUmFkaW9CdXR0b25zLmFudC1yYWRpby1idXR0b24td3JhcHBlcjo6YmVmb3JlIHsKICBkaXNwbGF5OiBub25lOwogIHZpc2liaWxpdHk6IGhpZGRlbjsKfQoudGltZVJhZGlvQnV0dG9ucyB7CiAgYm9yZGVyOiBub25lOwp9Ci50aW1lUmFkaW9Hcm91cCB7CiAgbWFyZ2luLWxlZnQ6IDU0cHg7CiAgYm9yZGVyOiBub25lOwp9Ci5hbnQtcmFkaW8tYnV0dG9uLXdyYXBwZXItY2hlY2tlZDpub3QoLmFudC1yYWRpby1idXR0b24td3JhcHBlci1kaXNhYmxlZCkgewogIHotaW5kZXg6IDE7CiAgY29sb3I6ICMxODkwZmY7CiAgYmFja2dyb3VuZDogI2ZmZjsKICBib3JkZXItY29sb3I6ICNmZmZmZmY7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiAtMXB4IDAgMCAwICNmZmZmZmY7CiAgYm94LXNoYWRvdzogLTFweCAwIDAgMCAjZmZmZmZmOwp9Ci5hZmZpeGVkIHsKICBwYWRkaW5nOiAxMnB4OwogIGJhY2tncm91bmQtY29sb3I6ICNlNmY3ZmY7CiAgLXdlYmtpdC10cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yIDMwMG1zIGxpbmVhcjsKICAtbXMtdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAzMDBtcyBsaW5lYXI7CiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAzMDBtcyBsaW5lYXI7Cn0KLmFmZml4IHsKICBwYWRkaW5nOiAxMnB4OwogIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogIC13ZWJraXQtdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAzMDBtcyBsaW5lYXI7CiAgLW1zLXRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMzAwbXMgbGluZWFyOwogIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMzAwbXMgbGluZWFyOwp9Cg=="},{"version":3,"sources":["Member.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyqBA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Member.vue","sourceRoot":"src/views/dashboard","sourcesContent":["<template>\n  <div>\n    <a-row>\n      <a-col :span=\"24\" :style=\"{ background: '#ffffff', 'margin-bottom': '24px' }\">\n        <a-row type=\"flex\" justify=\"end\">\n          <a-col>\n            <a-affix :offset-top=\"10\" @change=\"affixChanged\">\n              <div :class=\"affixed ? 'affixed' : 'affix'\">\n                <a style=\"paddingright: 48px\">\n                  <a-select default-value=\"all\" style=\"width: 120px\" @change=\"handleTypeChange\">\n                    <a-select-option v-for=\"(option, index) in typeOptions\" :key=\"index\" :value=\"option.value\">\n                      {{ option.name }}\n                    </a-select-option>\n                  </a-select>\n                </a>\n                <a-radio-group :value=\"currentPeriod\" class=\"timeRadioGroup\" @change=\"handleTimeChange\">\n                  <a-radio-button\n                    v-for=\"(time, index) in timeOptions\"\n                    :key=\"index\"\n                    :value=\"time.value\"\n                    class=\"timeRadioButtons\"\n                  >\n                    {{ time.name }}\n                  </a-radio-button>\n                </a-radio-group>\n                <a-range-picker\n                  :disabled-date=\"disabledDate\"\n                  @change=\"handleDateRangeChange\"\n                  :style=\"{ width: '256px', 'margin-left': '24px', 'margin-right': '48px' }\"\n                  :value=\"dateRange\"\n                />\n              </div>\n            </a-affix>\n          </a-col>\n        </a-row>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"24\">\n      <a-col :span=\"8\" :style=\"{ marginBottom: '24px' }\">\n        <chart-card :loading=\"loading\" title=\"代码行数\" :total=\"formatNumberString(codeAnalysis.codeNum)\">\n          <a-tooltip title=\"RD增加和删减累计代码行数\" slot=\"action\">\n            <a-icon type=\"info-circle-o\" />\n          </a-tooltip>\n          <div style=\"postion: relative\">\n            <span class=\"ant-font-2\" slot=\"term\">新增</span>\n            {{ formatNumberString(codeAnalysis.addCodeNum) }}\n            <br />\n            <span class=\"ant-font-2\" slot=\"term\">删除</span>\n            {{ formatNumberString(codeAnalysis.delCodeNum) }}\n            <a-progress\n              style=\"position: absolute; right: 0; bottom: 0px\"\n              type=\"circle\"\n              :percent=\"formatPercentString(codeAnalysis.addProportion * 100)\"\n              :width=\"90\"\n              :format=\"(percent) => `新增占比  ${percent}% `\"\n              :strokeWidth=\"10\"\n            />\n          </div>\n          <template slot=\"footer\">\n            <trend\n              :flag=\"codeAnalysis.comparisonDirection === 'down' ? 'down' : 'up'\"\n              :style=\"{\n                visibility: codeAnalysis.comparisonDirection == 'hide' ? 'hidden' : 'visible',\n                'margin-right': '16px',\n              }\"\n            >\n              <span slot=\"term\">{{ reletiveText }}</span>\n              {{ formatPercentString(codeAnalysis.comparison * 100) }}%\n            </trend>\n          </template>\n        </chart-card>\n      </a-col>\n\n      <a-col :span=\"8\" :style=\"{ marginBottom: '24px' }\">\n        <chart-card :loading=\"loading\" title=\"新需求测试case数\" :total=\"formatNumberString(newCaseCount.sum)\">\n          <a-tooltip title=\"新需求累计执行case数\" slot=\"action\">\n            <a-icon type=\"info-circle-o\" />\n          </a-tooltip>\n          <template slot=\"footer\">\n            <trend\n              :flag=\"newCaseCount.trend == 'down' ? 'down' : 'up'\"\n              :style=\"{ visibility: newCaseCount.trend == 'hide' ? 'hidden' : 'visible', 'margin-right': '16px' }\"\n            >\n              <span slot=\"term\">{{ reletiveText }}</span>\n              {{ formatPercentString(newCaseCount.ratio * 100) }}%\n            </trend>\n          </template>\n        </chart-card>\n      </a-col>\n\n      <a-col :span=\"8\" :style=\"{ marginBottom: '24px' }\">\n        <chart-card :loading=\"loading\" title=\"公测包回归case数\" :total=\"formatNumberString(publicBetaTestCase.caseNum)\">\n          <a-tooltip title=\"公测包累计回归case数\" slot=\"action\">\n            <a-icon type=\"info-circle-o\" />\n          </a-tooltip>\n          <div style=\"postion: relative\">\n            <span class=\"ant-font-2\" slot=\"term\">人工</span>\n            {{ formatNumberString(publicBetaTestCase.manualCaseNum) }}\n            <br />\n            <span class=\"ant-font-2\" slot=\"term\">自动化</span>\n            {{ formatNumberString(publicBetaTestCase.autoCaseNum) }}\n            <a-progress\n              style=\"position: absolute; right: 0; bottom: 0px\"\n              type=\"circle\"\n              :percent=\"formatPercentString(publicBetaTestCase.autoProportion * 100)\"\n              :width=\"90\"\n              :format=\"(percent) => `自动化占比${percent}% `\"\n              :strokeWidth=\"10\"\n            />\n          </div>\n          <template slot=\"footer\">\n            <span style=\"margin-right: 16px\"></span>\n          </template>\n        </chart-card>\n      </a-col>\n    </a-row>\n\n    <a-card :loading=\"loading\" :bordered=\"false\" :body-style=\"{ padding: '30px' }\">\n      <div class=\"salesCard\">\n        <a-tabs\n          default-active-key=\"RD\"\n          :activeKey=\"currentTab\"\n          size=\"large\"\n          :tab-bar-style=\"{ marginBottom: '24px', paddingLeft: '16px' }\"\n          @change=\"handleTabChange\"\n        >\n          <a-tab-pane :forceRender=\"true\" tab=\"RD\" key=\"RD\">\n            <div class=\"ant-table-wrapper\">\n              <a-table\n                row-key=\"index\"\n                size=\"middle\"\n                :columns=\"rdTableColumns\"\n                :dataSource=\"rdData\"\n                :pagination=\"{ pageSize: 10 }\"\n                :loading=\"loadingRD\"\n                :scroll=\"{ scrollToFirstRowOnChange: false }\"\n              >\n                <span slot=\"codeVsbugComparison\" slot-scope=\"codeVsbugComparison\"> {{ codeVsbugComparison }}‰ </span>\n                <span slot=\"unresolvedBugProbability\" slot-scope=\"unresolvedBugProbability\">\n                  {{ unresolvedBugProbability }}%\n                </span>\n              </a-table>\n            </div>\n          </a-tab-pane>\n          <a-tab-pane :forceRender=\"true\" tab=\"QA\" key=\"QA\">\n            <div class=\"ant-table-wrapper\">\n              <a-table\n                row-key=\"index\"\n                size=\"middle\"\n                :columns=\"qaTableColumns\"\n                :dataSource=\"qaData\"\n                :pagination=\"{ pageSize: 10 }\"\n                :loading=\"loadingQA\"\n                :scroll=\"{ scrollToFirstRowOnChange: false }\"\n              >\n                <span slot=\"missBugProbability\" slot-scope=\"missBugProbability\"> {{ missBugProbability }}% </span>\n              </a-table>\n            </div>\n          </a-tab-pane>\n          <a-auto-complete\n            class=\"global-search\"\n            size=\"large\"\n            style=\"width: 100%\"\n            placeholder=\"输入姓名\"\n            option-label-prop=\"value\"\n            @select=\"onSelect\"\n            @search=\"handleSearch\"\n            slot=\"tabBarExtraContent\"\n            v-model=\"searchWord\"\n            allow-clear\n          >\n            <template slot=\"dataSource\">\n              <a-select-option v-for=\"word in keywords\" :key=\"word\" :value=\"word\">\n                {{ word }}\n              </a-select-option>\n            </template>\n            <a-input>\n              <a-icon slot=\"prefix\" type=\"search\" />\n            </a-input>\n          </a-auto-complete>\n        </a-tabs>\n      </div>\n    </a-card>\n  </div>\n</template>\n\n<script>\nimport { axios } from '@/utils/request'\nimport {\n  ChartCard,\n  MiniArea,\n  MiniBar,\n  MiniProgress,\n  RankList,\n  Bar,\n  Trend,\n  NumberInfo,\n  MiniSmoothArea,\n} from '@/components'\nimport { baseMixin } from '@/store/app-mixin'\nimport Vue from 'vue'\nimport moment from 'moment'\nimport _ from 'lodash'\n\n// RD表头\nconst rdTableColumns = [\n  {\n    dataIndex: 'index',\n    title: '序号',\n    width: 90,\n  },\n  {\n    dataIndex: 'name',\n    title: '姓名',\n    width: 150,\n  },\n  {\n    dataIndex: 'functionNum',\n    title: '项目数量',\n    align: 'right',\n    sorter: (a, b) => a.functionNum - b.functionNum,\n  },\n  {\n    dataIndex: 'addCodeNum',\n    title: '新增代码行数',\n    align: 'right',\n    sorter: (a, b) => a.codeNum - b.codeNum,\n  },\n  {\n    dataIndex: 'delCodeNum',\n    title: '删除代码行数',\n    align: 'right',\n    sorter: (a, b) => a.codeNum - b.codeNum,\n  },\n  {\n    dataIndex: 'bugNum',\n    title: 'BUG总数',\n    align: 'right',\n    sorter: (a, b) => a.bugNum - b.bugNum,\n  },\n  {\n    dataIndex: 'codeVsbugComparison',\n    title: '千行代码BUG率',\n    align: 'right',\n    sorter: (a, b) => a.codeVsbugComparison - b.codeVsbugComparison,\n    scopedSlots: { customRender: 'codeVsbugComparison' },\n  },\n  {\n    dataIndex: 'unresolvedBug',\n    title: '遗留bug数',\n    align: 'right',\n    sorter: (a, b) => a.unresolvedBug - b.unresolvedBug,\n  },\n  {\n    dataIndex: 'unresolvedBugProbability',\n    title: '遗留bug率',\n    align: 'right',\n    sorter: (a, b) => a.unresolvedBugProbability - b.unresolvedBugProbability,\n    scopedSlots: { customRender: 'unresolvedBugProbability' },\n  },\n]\n\n// QA表头\nconst qaTableColumns = [\n  {\n    dataIndex: 'index',\n    title: '序号',\n    width: 90,\n  },\n  {\n    dataIndex: 'name',\n    title: '姓名',\n    width: 150,\n  },\n  {\n    dataIndex: 'functionNum',\n    title: '项目数量',\n    align: 'right',\n    sorter: (a, b) => a.functionNum - b.functionNum,\n  },\n  {\n    dataIndex: 'writeCaseNum',\n    title: 'case编写数量',\n    align: 'right',\n    sorter: (a, b) => a.writeCaseNum - b.writeCaseNum,\n  },\n  {\n    dataIndex: 'executeCaseNum',\n    title: 'case执行数量',\n    align: 'right',\n    sorter: (a, b) => a.executeCaseNum - b.executeCaseNum,\n  },\n  {\n    dataIndex: 'submitBugNum',\n    title: '提交bug数',\n    align: 'right',\n    sorter: (a, b) => a.range - b.range,\n  },\n  {\n    dataIndex: 'missBugNum',\n    title: '漏测bug数',\n    align: 'right',\n    sorter: (a, b) => a.missBugNum - b.missBugNum,\n  },\n  {\n    dataIndex: 'missBugProbability',\n    title: '漏测bug率',\n    align: 'right',\n    sorter: (a, b) => a.missBugProbability - b.missBugProbability,\n    scopedSlots: { customRender: 'missBugProbability' },\n  },\n]\n\nconst timePeriod = {\n  all: 'all',\n  year: 'year',\n  quarter: 'quarter',\n  month: 'month',\n  lastMonth: 'lastMonth',\n  custom: 'custom',\n}\n\nexport default {\n  name: 'Analysis',\n  mixins: [baseMixin],\n  components: {\n    ChartCard,\n    MiniArea,\n    MiniBar,\n    MiniProgress,\n    RankList,\n    Bar,\n    Trend,\n    NumberInfo,\n    MiniSmoothArea,\n  },\n\n  data() {\n    return {\n      keywords: new Set(),\n      keywordsBackup: null,\n      searchWord: '',\n      timePeriod,\n      affixed: false,\n      loading: true,\n      loadingQA: true,\n      loadingRD: true,\n      rdTableColumns,\n      rdData: [],\n      rdDataBackup: [],\n      qaTableColumns,\n      qaData: [],\n      qaDataBackup: [],\n      currentTab: 'RD',\n      currentType: 'all',\n      currentStartTime: this.getFirstDayOfMonth(),\n      currentEndTime: this.getEndOfMonth(),\n      currentPeriod: this.dayjs().date() < 10 ? timePeriod.lastMonth : timePeriod.month,\n      dateRange: [],\n      reletiveText: '月环比',\n      codeAnalysis: {\n        codeNum: 0,\n        addCodeNum: 0,\n        delCodeNum: 0,\n        addProportion: 0.0,\n        comparison: 0.0,\n        comparisonDirection: 'up',\n      },\n      newCaseCount: {\n        sum: 0,\n        trend: 'hide',\n        ratio: 0.0,\n      },\n      publicBetaTestCase: {\n        caseNum: 0,\n        manualCaseNum: 0,\n        autoCaseNum: 0,\n        autoProportion: 0.0,\n      },\n      typeOptions: [\n        { name: '全部', value: 'all' },\n        { name: '营收产品', value: 'products' },\n        { name: '营收活动', value: 'activity' },\n        { name: 'SC', value: 'SC' },\n        { name: '增长', value: 'increase' },\n        { name: '社交&基础', value: 'social' },\n        { name: '媒体', value: 'basic' },\n      ],\n      timeOptions: [\n        { name: '上月', value: timePeriod.lastMonth },\n        { name: '本月', value: timePeriod.month },\n        { name: '本季度', value: timePeriod.quarter },\n        { name: '本年', value: timePeriod.year },\n      ],\n    }\n  },\n  watch: {\n    currentPeriod: function (val) {\n      if (val == this.timePeriod.month) {\n        this.reletiveText = '月环比'\n      } else if (val == this.timePeriod.quarter) {\n        this.reletiveText = '季环比'\n      } else if (val == this.timePeriod.year) {\n        this.reletiveText = '年环比'\n      }\n    },\n  },\n  created() {\n    this.init()\n  },\n  methods: {\n    init() {\n      console.log('currentPeriod', this.currentPeriod)\n      this.changeTime(this.currentPeriod)\n      this.initCodeAnalysis()\n      this.initPublicBetaTestCase()\n      this.initQAData()\n      this.initRDData()\n      this.getNewCaseCount()\n      this.$nextTick(() => {\n        this.loading = false\n      })\n    },\n    refreshData() {\n      console.log(\n        `refreshData: tab = ${this.currentTab}, type = ${this.currentType}, stime = ${this.currentStartTime}, etime = ${this.currentEndTime}, period = ${this.currentPeriod}`\n      )\n      this.loadingQA = true\n      this.initQAData()\n      this.loadingRD = true\n      this.initRDData()\n      this.initCodeAnalysis()\n      this.initPublicBetaTestCase()\n      this.getNewCaseCount()\n    },\n    /** 获取QA表格数据 */\n    initQAData() {\n      axios\n        .post('/QAPersonalController/getQAPersonalDetails', {\n          projectName: this.currentType,\n          stime: this.currentStartTime,\n          etime: this.getEndOfMonth(),\n          period: this.currentPeriod,\n        })\n        .then((response) => {\n          let data = response.result\n          for (let i = 0; i < data.length; i++) {\n            data[i].index = i + 1\n            data[i].missBugProbability = Math.round(Number(data[i].missBugProbability) * 10000) / 100\n          }\n          this.$nextTick(() => {\n            this.qaData = data\n          })\n          this.qaDataBackup = data\n          data.forEach((e) => this.keywords.add(e.name))\n          this.keywordsBackup = this.keywords\n          this.loadingQA = false\n        })\n        .catch((error) => {\n          this.loadingQA = false\n          console.log(error)\n          this.$message.error('QA表格数据获取失败')\n        })\n    },\n    /** 获取RD表格数据 */\n    initRDData() {\n      axios\n        .post('/RDPersonalController/getRDPersonalDetails', {\n          projectName: this.currentType,\n          stime: this.currentStartTime,\n          etime: this.getEndOfMonth(),\n          period: this.currentPeriod,\n        })\n        .then((response) => {\n          let data = response.data\n          for (let i = 0; i < data.length; i++) {\n            data[i].index = i + 1\n            for (var key in data[i]) {\n              if (data[i][key] == null) {\n                data[i][key] = 0\n              }\n            }\n            data[i].unresolvedBugProbability = Math.round(Number(data[i].unresolvedBugProbability) * 10000) / 100\n            data[i].codeVsbugComparison = Math.round(Number(data[i].codeVsbugComparison) * 100000) / 100\n          }\n          this.$nextTick(() => {\n            this.rdData = data\n          })\n          this.rdDataBackup = data\n          data.forEach((e) => this.keywords.add(e.name))\n          this.loadingRD = false\n        })\n        .catch((error) => {\n          this.loadingRD = false\n          console.log(error)\n          this.$message.error('RD表格数据获取失败')\n        })\n    },\n    /** 初始化代码行数数据 */\n    initCodeAnalysis() {\n      axios\n        .post('/RDPersonalController/getCodeAnalysis', {\n          projectName: this.currentType,\n          stime: this.currentStartTime,\n          etime: this.getEndOfMonth(),\n          period: this.currentPeriod,\n        })\n        .then((response) => {\n          this.codeAnalysis = response.data\n        })\n        .catch((error) => {\n          console.log(error)\n          this.$message.error('代码行数数据获取失败')\n        })\n    },\n    /** 初始化公测包回归case数数据 */\n    initPublicBetaTestCase() {\n      axios\n        .post('/QAPersonalController/getPublicBetaTestCase', {\n          stime: this.currentStartTime,\n          etime: this.getEndOfMonth(),\n          period: this.currentPeriod,\n        })\n        .then((response) => {\n          this.publicBetaTestCase = response.data\n        })\n        .catch((error) => {\n          console.log(error)\n          this.$message.error('公测包case数据获取失败')\n        })\n    },\n    /** 初始化新需求case数数据 */\n    getNewCaseCount() {\n      axios\n        .post('/QAPersonalController/getNewCaseCount', {\n          stime: this.currentStartTime,\n          etime: this.getEndOfMonth(),\n          period: this.currentPeriod,\n          projectName: this.currentType,\n        })\n        .then((response) => {\n          this.newCaseCount = response.data\n          Vue.set(this.newCaseCount, 'trend', response.data.trend)\n        })\n        .catch((error) => {\n          console.log(error)\n          this.$message.error('新需求case数据获取失败')\n        })\n    },\n    /** tab变更。QA/RD 两种tab */\n    handleTabChange(tabKey) {\n      this.currentTab = tabKey\n    },\n    /** 类型变更。全部、基础、PK等 */\n    handleTypeChange(type) {\n      this.currentType = type\n      this.refreshData()\n    },\n    /** 时间段变更。当月、当季度等 */\n    handleTimeChange(scope) {\n      let time = scope.target.value\n      this.changeTime(time)\n      console.log('time changed ' + time)\n      this.refreshData()\n    },\n    changeTime(time) {\n      switch (time) {\n        case 'lastMonth':\n          this.currentStartTime = this.getFirstDayOfLastMonth()\n          this.currentEndTime = this.getEndOfLastMonth()\n          this.currentPeriod = this.timePeriod.lastMonth\n          this.dateRange = this.getDateRange()\n          break\n        case 'month':\n          this.currentStartTime = this.getFirstDayOfMonth()\n          this.currentEndTime = this.getEndOfMonth()\n          this.currentPeriod = this.timePeriod.month\n          this.dateRange = this.getDateRange()\n          break\n        case 'year':\n          this.currentStartTime = this.getFirstDayOfYear()\n          this.currentEndTime = this.getEndOfMonth()\n          this.currentPeriod = this.timePeriod.year\n          this.dateRange = this.getDateRange()\n          break\n        case 'quarter':\n          this.currentStartTime = this.getFirstDayOfQuarter()\n          this.currentEndTime = this.getEndOfMonth()\n          this.currentPeriod = this.timePeriod.quarter\n          this.dateRange = this.getDateRange()\n          break\n        // TODO: all的时间段是多少？\n        case 'all':\n          this.currentStartTime = this.getFirstDayOfYear()\n          this.currentEndTime = this.getEndOfMonth()\n          this.currentPeriod = this.timePeriod.all\n          this.dateRange = this.getDateRange()\n          break\n        default:\n      }\n    },\n    /** 日期选择器范围变化 */\n    handleDateRangeChange(range) {\n      this.currentStartTime = this.dayjs(range[0].valueOf()).startOf('day').format('YYYY-MM-DD HH:mm:ss')\n      this.currentEndTime = this.dayjs(range[1].valueOf()).endOf('day').format('YYYY-MM-DD HH:mm:ss')\n      this.currentPeriod = timePeriod.custom\n      this.refreshData()\n    },\n    onSelect(value) {\n      console.log('onSelect', value)\n      this.filterData(value)\n      this.searchWord = value\n    },\n    handleSearch(value) {\n      if (_.isEmpty(value)) {\n        this.qaData = this.qaDataBackup\n        this.rdData = this.rdDataBackup\n        this.keywords = this.keywordsBackup\n      }\n      console.log('handleSearch', value)\n      this.filterData(value)\n    },\n    filterData(value) {\n      this.keywords = Array.from(this.keywordsBackup).filter((e) => e.indexOf(value) >= 0)\n      this.qaData = this.qaDataBackup.filter((e) => e.name.indexOf(value) >= 0)\n      this.rdData = this.rdDataBackup.filter((e) => e.name.indexOf(value) >= 0)\n      if (this.qaData.length == 0 && this.rdData.length > 0) {\n        this.currentTab = 'RD'\n      }\n      if (this.qaData.length > 0 && this.rdData.length == 0) {\n        this.currentTab = 'QA'\n      }\n    },\n    // 获取初始时间，参考 https://day.js.org/docs/en/manipulate/start-of\n    /** 获取当月第一天的格式化时间戳 */\n    getFirstDayOfMonth() {\n      return this.dayjs().startOf('month').format('YYYY-MM-DD HH:mm:ss')\n    },\n    /** 获取当季度第一天的格式化时间戳 */\n    getFirstDayOfQuarter() {\n      return this.dayjs().startOf('quarter').format('YYYY-MM-DD HH:mm:ss')\n    },\n    /** 获取当自然年第一天的格式化时间戳 */\n    getFirstDayOfYear() {\n      return this.dayjs().startOf('year').format('YYYY-MM-DD HH:mm:ss')\n    },\n    /** 获取当天结束时间的格式化时间戳 */\n    getEndOfMonth() {\n      return this.dayjs().endOf('month').format('YYYY-MM-DD HH:mm:ss')\n    },\n    getFirstDayOfLastMonth() {\n      return this.dayjs().subtract(1, 'month').startOf('month').format('YYYY-MM-DD HH:mm:ss')\n    },\n    getEndOfLastMonth() {\n      return this.dayjs().subtract(1, 'month').endOf('month').format('YYYY-MM-DD HH:mm:ss')\n    },\n    getDateRange() {\n      console.log('getDateRange', this.currentStartTime, this.currentEndTime)\n      return [moment(this.currentStartTime, this.dateFormat), moment(this.currentEndTime, this.dateFormat)]\n    },\n    formatNumberString(number) {\n      return Number(number).toLocaleString('en')\n    },\n    formatPercentString(number) {\n      if (number == null) {\n        return number\n      }\n      return Number(Number(number).toFixed(2))\n    },\n    affixChanged() {\n      this.affixed = !this.affixed\n    },\n    disabledDate(current) {\n      // 不能选择今天之后的日期\n      return current && current > moment().endOf('day')\n    },\n  },\n}\n</script>\n\n<style lang=\"less\" scoped>\n.extra-wrapper {\n  line-height: 55px;\n  padding-right: 24px;\n\n  .extra-item {\n    display: inline-block;\n    margin-right: 24px;\n\n    a {\n      margin-left: 24px;\n    }\n  }\n}\n\n.antd-pro-pages-dashboard-analysis-twoColLayout {\n  position: relative;\n  display: flex;\n  display: block;\n  flex-flow: row wrap;\n}\n\n.antd-pro-pages-dashboard-analysis-salesCard {\n  width: 100%;\n  height: calc(100% - 24px);\n  /* /deep/ .ant-card-head {\n    position: relative;\n  } */\n}\n\n.ant-col-3 {\n  width: 33%;\n}\n\n.ant-font-2 {\n  font-size: 13px;\n}\n.dashboard-analysis-iconGroup {\n  i {\n    margin-left: 16px;\n    color: rgba(0, 0, 0, 0.45);\n    cursor: pointer;\n    transition: color 0.32s;\n    color: black;\n  }\n}\n.analysis-salesTypeRadio {\n  position: absolute;\n  right: 54px;\n  bottom: 12px;\n}\n\n.timeRadioGroup {\n  margin-left: 54px;\n}\n\n.timeRadioButtons.ant-radio-button-wrapper::before {\n  display: none;\n  visibility: hidden;\n}\n.timeRadioButtons {\n  border: none;\n}\n.timeRadioGroup {\n  margin-left: 54px;\n  border: none;\n}\n.ant-radio-button-wrapper-checked:not(.ant-radio-button-wrapper-disabled) {\n  z-index: 1;\n  color: #1890ff;\n  background: #fff;\n  border-color: #ffffff;\n  -webkit-box-shadow: -1px 0 0 0 #ffffff;\n  box-shadow: -1px 0 0 0 #ffffff;\n}\n.affixed {\n  padding: 12px;\n  background-color: #e6f7ff;\n  -webkit-transition: background-color 300ms linear;\n  -ms-transition: background-color 300ms linear;\n  transition: background-color 300ms linear;\n}\n.affix {\n  padding: 12px;\n  background-color: white;\n  -webkit-transition: background-color 300ms linear;\n  -ms-transition: background-color 300ms linear;\n  transition: background-color 300ms linear;\n}\n</style>\n"]}]}